---
title: "Alpha-diversity"
subtitle: "Where we analyse the effect of a factor on local diversity"
date: last-modified
author:
  - name: Adrien Taudi√®re
    url: https://adrientaudiere.github.io/bioinfo.starter/analysis/02_alpha_diversity.qmd
    affiliation: IdEst
    affiliation-url: https://orcid.org/my-orcid?orcid=0000-0003-1088-1182
citation: true
params:
  factor_of_interest: "Type"
# bibliography: bibliography.bib
# link-citations: true
---

See the documentation of the `MiscMetabar` package for example of [alpha diversity analysis](https://adrientaudiere.github.io/MiscMetabar/articles/alpha-div.html). 

```{r}
if(base::interactive()) {
  params <- rmarkdown::yaml_front_matter(here::here("analysis/03_beta_diversity.qmd"))$params
}
factor_of_interest <- params$factor_of_interest
```


```{r}
#| message: false
#| warning: false
library(knitr)
library(targets)
library(MiscMetabar)
here::i_am("analysis/02_alpha_diversity.qmd")
source(here::here("R/styles.R"))
```

```{r}
d_mfre <- clean_pq(d_mfre)
```


```{r}
#| error: true
hill_pq(subset_samples(d_pq, Type %in% c("Mix", "Mono")), factor_of_interest, one_plot = TRUE) &
  (
    theme_idest(
      subtitle_size = 8,
      plot_title_size = 12,
      plot_margin = margin(5, 10, 5, 10),
      axis_title_size = 9,
      axis_text_size = 8
    ) + theme(legend.position = "none")
  ) 
```


```{r}
#| error: true
MiscMetabar::accu_plot_balanced_modality(d_pq, factor_of_interest, nperm=20) + theme_idest()
```


```{r}
ggbetween_pq(d_mfre, "type_ech", one_plot = TRUE)
ggbetween_pq(d_mfre, "Type", one_plot = TRUE)
ggbetween_pq(d_mfre, "Tmt", one_plot = TRUE)
```


```{r}
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), Tmt, Hill_0)
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), Tmt, Hill_1)
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), Tmt, Hill_2)
```


```{r}
psmelt_samples_pq(d_mfre) |>
  group_by(type_ech) |>
    summarise(across(Abundance, 
                     .fns = 
                     list(min = min,
                          mean = mean,
                          stdev = sd,
                          q25 = ~quantile(., 0.25),
                          median = ~quantile(., 0.5),
                          q75 = ~quantile(., 0.75),
                          max = max)))
```


```{r}
# psmelt_samples_pq(d_mfre) |>
#   ggplot(aes(x = Abundance, y = type_ech)) +
#   geom_violin(
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), type_ech, Abundance)
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), type_ech, Hill_0)
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), type_ech, Hill_1)
ggstatsplot::ggbetweenstats(psmelt_samples_pq(d_mfre), type_ech, Hill_2)
```



{{< include _session_info.qmd >}}
