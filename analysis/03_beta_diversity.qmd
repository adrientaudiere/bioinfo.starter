---
title: "Beta-diversity analysis"
subtitle: "Where we analyse the effect of a factor on shared diversity"
date: last-modified
author:
  - name: Adrien Taudi√®re
    url: https://adrientaudiere.github.io/bioinfo.starter/analysis/02_alpha_diversity.qmd
    affiliation: IdEst
    affiliation-url: https://orcid.org/my-orcid?orcid=0000-0003-1088-1182
    citation: true
params:
  factor_of_interest: "type_ech"
# bibliography: bibliography.bib
# link-citations: true
---

See the documentation of the `MiscMetabar` package for example of [btea diversity analysis](https://adrientaudiere.github.io/MiscMetabar/articles/beta-div.html). 

```{r}
if(base::interactive()) {
  params <- rmarkdown::yaml_front_matter(here::here("analysis/03_beta_diversity.qmd"))$params
}
factor_of_interest <- params$factor_of_interest
```

```{r,  message=FALSE, warning=FALSE}
library(knitr)
library(targets)
library(MiscMetabar)
here::i_am("analysis/03_beta_diversity.qmd")
source(here::here("R/styles.R"))
```

```{r}
d_mfre <- clean_pq(d_mfre)
```


```{r}
d_mfre@sam_data$type_ech_tmt <- paste(d_mfre@sam_data$type_ech, d_mfre@sam_data$Tmt, sep="_")
formattable_pq(
    d_mfre,
    "type_ech_tmt",
    min_nb_seq_taxa = 0, 
    lev_col_taxa = "Family",
    taxonomic_levels=c("Order_E", "Family_E", "Genus_E"),
    log10trans = FALSE
  )

formattable_pq(
    as_binary_otu_table(d_mfre),
    "type_ech_tmt",
    min_nb_seq_taxa = 0, 
    lev_col_taxa = "Family",
    taxonomic_levels=c("Order_E", "Family_E", "Genus_E"),
    log10trans = FALSE
  )
```


```{r}
#| error: true
adonis_pq(d_mfre, "Tmt+type_ech+Type", na_remove = TRUE, correction_for_sample_size = TRUE, by = "terms")
```


```{r}
#| error: true
d_mfre |>
  biplot_pq(merge_sample_by = "Tmt", rarefy_after_merging = T, )
```


```{r}
#| error: true
res_var <- var_par_rarperm_pq(
   d_mfre,
    list_component = list(
      "Tmt" = c("Tmt"),
      "type_ech" = c("type_ech"),
      "Type" = c("Type")
    ),
    nperm = 9,
    dbrda_computation = TRUE
  )

plot_var_part_pq(res_var)
```


{{< include _session_info.qmd >}}
